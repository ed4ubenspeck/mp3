---
title: "Markdown File"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(sf)
library(raster)
library(macleish)
library(leaflet)
```

<!-- Trying to get elevation data: -->
<!-- ```{r} -->
<!-- elevation <- mass_gis(layer = "contours250k") -->
<!-- ``` -->


<!-- Macleish elevation data: -->
<!-- ```{r} -->
<!-- elevation_sf <- elevation %>% -->
<!--   st_as_sf() -->

<!-- elevation_macleish <- elevation_sf %>% -->
<!--   st_intersection(macleish_layers[["boundary"]]) -->

<!-- ``` -->

Aggregating trail segments: **Do lengths change based on projection?
```{r}
total_trails <- macleish_layers[["trails"]] %>%
  group_by(name) %>%
  summarize(num_segments = n(), 
            total_length = sum(st_length(geometry)))
```


Testing plots
```{r}

contour_char <- macleish_layers[["contours_3m"]] %>%
  mutate(meter_char = as.character(ELEV_M))

color_fact <- colorFactor("Greens", contour_char$meter_char)
color_fact2 <- colorFactor("Set1", macleish_layers[["trails"]]$name)

m <- leaflet() %>%
  # Base groups
  addTiles(group = "OpenStreetMap") %>%
  addProviderTiles("Esri.WorldTopoMap", group = "Topography") %>%
  addProviderTiles("Esri.WorldImagery", group = "Satellite") %>%
  addProviderTiles("Stamen.TonerLite", group = "Toner Lite") %>%
    addPolygons(data = macleish_layers[["boundary"]], weight = 1, fillOpacity = 0.01, group = "Boundaries") %>%
  #other stuff
  addPolygons(data = contour_char, popup = ~meter_char, color = ~color_fact(meter_char), weight = .5) %>%
  addPolylines(data = macleish_layers[["trails"]], weight = 4, popup = ~name, color = ~color_fact2(name))

```

Trail and elevation intersections:
```{r}
test_data <- total_trails %>%
filter(name == "Porcupine Trail")

test_sf <- st_sf(test_data)

test_data1 <- contour_char %>%
  st_join(test_sf, join = st_intersects, left = FALSE)

trails_by_name <- c("Driveway", "Eastern Loop", "Easy Out", "entry trail", "Poplar Hill Road", "Porcupine Trail", "Snowmobile Trail", "Vernal Pool Loop", "Western Loop")

trail_tables <- function(trail_name){
  total_trails %>%
  filter(name == trail_name)
}
  
aggregate <- lapply(trails_by_name, trail_tables)
  
max_grade <- function(trail_table){  
  contour_char %>%
  st_join(trail_table, join = st_intersects, left=FALSE)
}

max_grade_tables <- lapply(aggregate, max_grade)
```

